<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-game-id="<%= game.id %>"><%= game.title %></title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.5.0/semantic.min.css">
  <link rel="stylesheet" href="/styles.css">

</head>
<body class="epic-theme">
  <div class="ui container main-container">
    <h1 class="ui header"><input value="<%= game.title %>" class="title"></input></h1>

    <div class="back-button-container">
      <a href="javascript:history.back()">
        <button class="ui button back-button">Назад</button>
      </a>
    </div>

    <table class="ui very basic collapsing celled table">
      <tbody>
        <tr>
          <td>
            <b>Описание:</b>
          </td>
          <td>
            <input value="<%= game.description %>" class="description"></input>
          </td>
        </tr>
        <tr>
          <td>
            <b>Тип контента:</b>
          </td>
          <td>
            <input value="<%= content_type.name %>" class="content_type"></input>
          </td>
        </tr>
        <tr>
          <td>
            <b>Дата релиза:</b>
          </td>
          <td>
            <input value="<%= game.release_date %>" class="release_date"></input>
          </td>
        </tr>
        <tr>
          <td>
            <b>Жанры:</b>
          </td>
          <td>
            <input value="<%= game.genres %>" class="genres"></input>
          </td>
        </tr>
        <tr>
          <td>
            <b>Разработчик:</b>
          </td>
          <td>
            <input value="<%= developer.name %>" class="developer"></input>
          </td>
        </tr>
        <tr>
          <td>
            <b>Издатель:</b>
          </td>
          <td>
            <input value="<%= publisher.name %>" class="publisher"></input>
          </td>
        </tr>
        <tr>
          <td>
            <b>Поддерживаемые ОС:</b>
          </td>
          <td>
            <input value="<%= game.supported_os %>" class="supported_os"></input>
          </td>
        </tr>
    </table>

    <div class="crud">
      <a href="/epic_new_game_page.html">
        <button class="ui button create">Создать</button>
      </a>
      <button class="ui button update" onclick="UpdateGame()">Изменить</button>
      <script>
        const updateButton = document.querySelector('.ui.button.update');
        updateButton.addEventListener('click', UpdateGame);

        function UpdateGame() {
          const title = document.getElementsByClassName("title")[0].value;
          const description = document.getElementsByClassName("description")[0].value;
          const content_type = document.getElementsByClassName("content_type")[0].value;
          const release_date = document.getElementsByClassName("release_date")[0].value;
          const genres = document.getElementsByClassName("genres")[0].value;
          const developer = document.getElementsByClassName("developer")[0].value;
          const publisher = document.getElementsByClassName("publisher")[0].value;
          const supported_os = document.getElementsByClassName("supported_os")[0].value;
          
          const game = {
              "title": title,
              "content_type": content_type,
              "description": description,
              "release_date": release_date,
              "genres": genres,
              "platform": "Epic Games",
              "developer": developer,
              "publisher": publisher,
              "supported_os": supported_os,
          }

          fetch('/epicgames/games/update', {
              method: 'POST',
              headers: {
              'Content-Type': 'application/json'
              },
              body: JSON.stringify(game),
          })
          .then(response => response.json())
          .then(data => {
              console.log('Успех:', data);
              alert('Игра успешно обновлена!');
          })
          .catch((error) => {
              console.error('Ошибка:', error);
              alert('Произошла ошибка при обновлении игры.');
          });
        }
      </script>
      <button class="ui button delete" onclick="DeleteGame()">Удалить</button>
      <script>
        document.getElementsByClassName("ui button delete").onclick = DeleteGame;
        const game_id = document.querySelector('[data-game-id]').getAttribute('data-game-id');
        function DeleteGame() {
          fetch('/epicgames/games/delete', {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({"id": game_id}),
          })
          .then(response => response.json())
          .then(data => {
            console.log('Успех:', data);
            alert('Игра успешно удалена!');
          })
          .catch((error) => {
            console.error('Ошибка:', error);
            alert('Произошла ошибка при удалении игры.');
          });
        }
      </script>
    </div>

  </div>

  <!-- <script src="./updateEpicGame.js"></script> -->
</body>
</html>